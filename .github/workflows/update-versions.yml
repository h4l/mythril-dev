name: "Auto-merge Dependabot PR"
on:
  pull_request_target:
    types: [opened, reopened]

jobs:
  update-dependencies:
    name: Update Dependencies & PR if Changed
    runs-on: ubuntu-latest
    if: ${{ github.event.pull_request.user.login == 'dependabot[bot]' && (github.actor == 'dependabot[bot]' || github.actor == github.repository_owner) }}
    permissions:
      contents: write
      pull-requests: write

    steps:
      - uses: tibdex/github-app-token@b62528385c34dbc9f38e5f4225ac829252d1ea92
        id: generate-token
        with:
          app_id: ${{ secrets.APP_ID }}
          private_key: ${{ secrets.APP_PRIVATE_KEY }}

      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Auto-merge Dependabot PR
        if: |
          startswith(github.event.pull_request.title, 'build(deps): bump')
        run: gh pr merge --auto --merge "${PULL_REQUEST:?}"
        env:
          GITHUB_TOKEN: ${{ steps.generate-token.outputs.token }}
          PULL_REQUEST: ${{ github.event.pull_request.html_url }}
